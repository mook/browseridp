<!DOCTYPE html>

<html>
<head>
    <title>BrowserIdP Sign in</title>
    <script type="text/javascript;version=1.8">
        const { classes: Cc, interfaces: Ci, utils: Cu } = Components;
        Cu.import("resource://gre/modules/Services.jsm");

        function base64(str)
            btoa(str).replace(/\+/g, "-").replace(/\//g, "_");

        navigator.id.beginAuthentication(function(email) {
            let host = email.replace(/^.*@/, "");
            let logins = Services.logins.findLogins({}, "x-browseridp:",
                                                    null, host);
            if (!logins.length) {
                // host not available
                navigator.id.raiseAuthenticationFailure("BrowserIdP cannot authenticate for host " + host);
                return;
            }
            navigator.id.completeAuthentication();
        });
    </script>
</head>
</html>
